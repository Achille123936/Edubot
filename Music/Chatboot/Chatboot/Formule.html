<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formules Mathématiques - EduBot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --correct-color: #4ade80;
            --incorrect-color: #f87171;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            background-color: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .nav-tab {
            padding: 8px 16px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .nav-tab:hover, .nav-tab.active {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            transition: var(--transition);
        }
        
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateX(-5px);
        }
        
        .back-button i {
            margin-right: 8px;
        }
        
        .formulas-content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .formulas-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark-color);
        }
        
        .formulas-title h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .formulas-title p {
            color: #6c757d;
            font-size: 1.1rem;
        }
        
        .categories-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .category-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            color: #6c757d;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .category-btn:hover {
            background: #e9ecef;
        }
        
        .category-btn.active:hover {
            background: var(--secondary-color);
        }
        
        .formulas-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .formula-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .formula-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .formula-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .formula-title {
            font-size: 1.3rem;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .formula-category {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            background: #e9ecef;
            color: #6c757d;
        }
        
        .formula-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .formula-equation {
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .formula-description {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .formula-example {
            background: #f1f3f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .formula-example-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-color);
        }
        
        .formula-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .formula-btn {
            padding: 8px 16px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .formula-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .formula-btn.secondary {
            background: #6c757d;
        }
        
        /* Interface d'administration */
        .admin-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
        }
        
        .admin-btn {
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .admin-btn:hover {
            opacity: 0.9;
        }
        
        .admin-btn.delete {
            background: var(--incorrect-color);
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .admin-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .admin-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 4px 8px;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .edit-btn {
            color: var(--primary-color);
        }
        
        .delete-btn {
            color: var(--incorrect-color);
        }
        
        .action-btn:hover {
            background-color: #f0f0f0;
        }
        
        /* Formulaire d'administration */
        .admin-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            display: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .formula-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Connexion administrateur */
        .login-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 400px;
            margin: 0 auto;
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--dark-color);
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .login-btn {
            padding: 12px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            opacity: 0.9;
        }
        
        .admin-actions-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            padding: 8px 16px;
            background: var(--incorrect-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            opacity: 0.9;
        }
        
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .search-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        @media (max-width: 768px) {
            .formulas-container {
                grid-template-columns: 1fr;
            }
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .back-button {
                align-self: center;
            }
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            .admin-actions-container {
                flex-direction: column;
                gap: 10px;
            }
            .categories-container {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            .formula-actions {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            .formula-btn {
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><i class="fas fa-square-root-variable"></i> EduBot Formules</h1>
                <div class="nav-tabs">
                    <a href="quiz.html" class="nav-tab">
                        <i class="fas fa-question-circle"></i> Quiz
                    </a>
                    <a href="exercises.html" class="nav-tab">
                        <i class="fas fa-pen-fancy"></i> Exercices
                    </a>
                    <a href="#" class="nav-tab active">
                        <i class="fas fa-square-root-variable"></i> Formules
                    </a>
                    <a href="#" class="nav-tab" id="admin-tab-btn">
                        <i class="fas fa-cog"></i> Administration
                    </a>
                </div>
            </div>
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Retour à l'Accueil
            </a>
        </div>

        <div class="formulas-content">
            <!-- Section des formules -->
            <div class="tab-content active" id="formulas-tab">
                <div class="formulas-title">
                    <h1>Formules Mathématiques</h1>
                    <p>Découvrez et mémorisez les formules essentielles pour réussir en mathématiques</p>
                </div>

                <div class="search-container">
                    <input type="text" class="search-input" id="search-formulas" placeholder="Rechercher une formule...">
                    <button class="formula-btn" id="search-btn">
                        <i class="fas fa-search"></i> Rechercher
                    </button>
                </div>

                <div class="categories-container" id="categories-container">
                    <button class="category-btn active" data-category="all">
                        <i class="fas fa-th-large"></i> Toutes
                    </button>
                    <button class="category-btn" data-category="algebra">
                        <i class="fas fa-calculator"></i> Algèbre
                    </button>
                    <button class="category-btn" data-category="geometry">
                        <i class="fas fa-shapes"></i> Géométrie
                    </button>
                    <button class="category-btn" data-category="trigonometry">
                        <i class="fas fa-wave-square"></i> Trigonométrie
                    </button>
                    <button class="category-btn" data-category="calculus">
                        <i class="fas fa-chart-line"></i> Analyse
                    </button>
                    <button class="category-btn" data-category="probability">
                        <i class="fas fa-dice"></i> Probabilités
                    </button>
                </div>

                <div class="formulas-container" id="formulas-container">
                    <!-- Les formules seront chargées dynamiquement -->
                </div>
            </div>

            <!-- Interface d'administration -->
            <div class="tab-content" id="admin-tab">
                <div class="admin-container" id="admin-login-container">
                    <div class="login-title">
                        <h2>Connexion Administrateur</h2>
                        <p>Veuillez vous connecter pour accéder au panneau d'administration</p>
                    </div>
                    <div class="login-form">
                        <div class="form-group">
                            <label class="form-label" for="admin-username">Nom d'utilisateur</label>
                            <input type="text" class="form-input" id="admin-username" placeholder="Entrez votre nom d'utilisateur">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="admin-password">Mot de passe</label>
                            <input type="password" class="form-input" id="admin-password" placeholder="Entrez votre mot de passe">
                        </div>
                        <button class="login-btn" id="admin-login-btn">
                            <i class="fas fa-sign-in-alt"></i> Se connecter
                        </button>
                    </div>
                </div>

                <div class="admin-container" id="admin-panel" style="display: none;">
                    <div class="admin-actions-container">
                        <div>
                            <h2>Gestion des Formules</h2>
                            <p>Bienvenue, <span id="admin-name">Administrateur</span></p>
                        </div>
                        <button class="logout-btn" id="admin-logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Déconnexion
                        </button>
                    </div>

                    <div class="admin-actions">
                        <button class="admin-btn" id="add-formula-btn">
                            <i class="fas fa-plus"></i> Ajouter une Formule
                        </button>
                        <button class="admin-btn" id="refresh-formulas-btn">
                            <i class="fas fa-sync-alt"></i> Actualiser
                        </button>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Catégorie</th>
                                <th>Titre</th>
                                <th>Formule</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="formulas-table-body">
                            <!-- Les formules seront chargées dynamiquement -->
                        </tbody>
                    </table>

                    <div class="admin-form" id="formula-form">
                        <h3 id="form-title">Ajouter une Formule</h3>
                        <div class="form-group">
                            <label class="form-label" for="formula-category">Catégorie</label>
                            <select class="form-select" id="formula-category">
                                <option value="algebra">Algèbre</option>
                                <option value="geometry">Géométrie</option>
                                <option value="trigonometry">Trigonométrie</option>
                                <option value="calculus">Analyse</option>
                                <option value="probability">Probabilités</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="formula-title">Titre de la formule</label>
                            <input type="text" class="form-input" id="formula-title" placeholder="Entrez le titre de la formule">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="formula-equation">Formule (en LaTeX)</label>
                            <input type="text" class="form-input" id="formula-equation" placeholder="Ex: E = mc^2">
                            <small>Utilisez la syntaxe LaTeX pour les formules mathématiques. Ex: \frac{a}{b} pour une fraction.</small>
                            <div class="formula-preview" id="formula-preview">
                                Aperçu de la formule
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="formula-description">Description</label>
                            <textarea class="form-textarea" id="formula-description" placeholder="Décrivez la formule et son utilisation"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="formula-example">Exemple d'application</label>
                            <textarea class="form-textarea" id="formula-example" placeholder="Donnez un exemple d'utilisation de la formule"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="admin-btn" id="cancel-formula-btn">Annuler</button>
                            <button class="admin-btn" id="save-formula-btn">Enregistrer</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Éléments DOM
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const formulasContainer = document.getElementById('formulas-container');
            const categoriesContainer = document.getElementById('categories-container');
            const categoryButtons = document.querySelectorAll('.category-btn');
            const adminTabBtn = document.getElementById('admin-tab-btn');
            const adminLoginContainer = document.getElementById('admin-login-container');
            const adminPanel = document.getElementById('admin-panel');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminLogoutBtn = document.getElementById('admin-logout-btn');
            const adminName = document.getElementById('admin-name');
            const formulasTableBody = document.getElementById('formulas-table-body');
            const formulaForm = document.getElementById('formula-form');
            const addFormulaBtn = document.getElementById('add-formula-btn');
            const cancelFormulaBtn = document.getElementById('cancel-formula-btn');
            const saveFormulaBtn = document.getElementById('save-formula-btn');
            const refreshFormulasBtn = document.getElementById('refresh-formulas-btn');
            const searchFormulasInput = document.getElementById('search-formulas');
            const searchBtn = document.getElementById('search-btn');
            const formulaPreview = document.getElementById('formula-preview');
            const formulaEquationInput = document.getElementById('formula-equation');

            // Variables
            let currentCategory = 'all';
            let isAdminLoggedIn = false;
            let isEditingFormula = false;
            let editingFormulaId = null;
            let formulasData = [];

            // Informations de connexion administrateur
            const adminCredentials = {
                username: "admin",
                password: "admin123"
            };

            // Initialisation
            initializeApp();

            // Fonctions d'initialisation
            function initializeApp() {
                loadFormulasData();
                setupEventListeners();
                checkAdminLoginStatus();
                renderFormulas();
                renderCategories();
            }

            function setupEventListeners() {
                // Navigation par onglets
                navTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tabId = tab.getAttribute('data-tab') || tab.id.replace('-btn', '');
                        switchTab(tabId);
                    });
                });

                // Filtres par catégorie
                categoryButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        categoryButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        currentCategory = this.getAttribute('data-category');
                        renderFormulas();
                    });
                });

                // Connexion administrateur
                adminLoginBtn.addEventListener('click', adminLogin);
                adminLogoutBtn.addEventListener('click', adminLogout);

                // Gestion des formules
                addFormulaBtn.addEventListener('click', showFormulaForm);
                cancelFormulaBtn.addEventListener('click', hideFormulaForm);
                saveFormulaBtn.addEventListener('click', saveFormula);
                refreshFormulasBtn.addEventListener('click', refreshAdminData);

                // Recherche
                searchBtn.addEventListener('click', performSearch);
                searchFormulasInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });

                // Aperçu de la formule
                formulaEquationInput.addEventListener('input', updateFormulaPreview);
            }

            function checkAdminLoginStatus() {
                const adminStatus = localStorage.getItem('adminLoggedIn');
                if (adminStatus === 'true') {
                    isAdminLoggedIn = true;
                    showAdminPanel();
                }
            }

            function switchTab(tabId) {
                // Mettre à jour les onglets actifs
                navTabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === tabId || tab.id === `${tabId}-btn`) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });

                // Afficher le contenu de l'onglet sélectionné
                tabContents.forEach(content => {
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });

                // Si on passe à l'onglet d'administration et que l'admin n'est pas connecté
                if (tabId === 'admin' && !isAdminLoggedIn) {
                    adminLoginContainer.style.display = 'block';
                    adminPanel.style.display = 'none';
                } else if (tabId === 'admin' && isAdminLoggedIn) {
                    adminLoginContainer.style.display = 'none';
                    adminPanel.style.display = 'block';
                    refreshAdminData();
                }
            }

            function loadFormulasData() {
                const savedFormulas = localStorage.getItem('formulasData');
                if (savedFormulas) {
                    formulasData = JSON.parse(savedFormulas);
                } else {
                    // Données par défaut
                    formulasData = [
                        {
                            id: 1,
                            category: 'algebra',
                            title: 'Théorème de Pythagore',
                            equation: 'a^2 + b^2 = c^2',
                            description: 'Dans un triangle rectangle, le carré de l\'hypoténuse est égal à la somme des carrés des deux autres côtés.',
                            example: 'Si un triangle rectangle a des côtés de longueurs 3 et 4, alors l\'hypoténuse est de longueur 5 car 3² + 4² = 9 + 16 = 25 = 5².'
                        },
                        {
                            id: 2,
                            category: 'geometry',
                            title: 'Aire d\'un cercle',
                            equation: 'A = \\pi r^2',
                            description: 'L\'aire d\'un cercle est égale à π multiplié par le rayon au carré.',
                            example: 'Pour un cercle de rayon 5 cm, l\'aire est π × 5² = 25π ≈ 78,54 cm².'
                        },
                        {
                            id: 3,
                            category: 'trigonometry',
                            title: 'Identité trigonométrique fondamentale',
                            equation: '\\sin^2(\\theta) + \\cos^2(\\theta) = 1',
                            description: 'Pour tout angle θ, la somme des carrés du sinus et du cosinus est égale à 1.',
                            example: 'Si sin(θ) = 0,6, alors cos(θ) = √(1 - 0,6²) = √(1 - 0,36) = √0,64 = 0,8.'
                        },
                        {
                            id: 4,
                            category: 'algebra',
                            title: 'Équation du second degré',
                            equation: 'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                            description: 'Formule pour résoudre les équations de la forme ax² + bx + c = 0.',
                            example: 'Pour résoudre x² - 5x + 6 = 0, on a a=1, b=-5, c=6. Le discriminant est (-5)² - 4×1×6 = 25-24=1. Les solutions sont x = (5±1)/2, soit x=3 et x=2.'
                        },
                        {
                            id: 5,
                            category: 'calculus',
                            title: 'Dérivée d\'une puissance',
                            equation: '\\frac{d}{dx} x^n = n x^{n-1}',
                            description: 'La dérivée de x puissance n est n fois x puissance n-1.',
                            example: 'La dérivée de f(x) = x³ est f\'(x) = 3x².'
                        },
                        {
                            id: 6,
                            category: 'probability',
                            title: 'Probabilité conditionnelle',
                            equation: 'P(A|B) = \\frac{P(A \\cap B)}{P(B)}',
                            description: 'La probabilité de A sachant B est égale à la probabilité de A et B divisée par la probabilité de B.',
                            example: 'Si la probabilité qu\'il pleuve (A) et que je prenne mon parapluie (B) est de 0,2, et la probabilité que je prenne mon parapluie est de 0,5, alors P(A|B) = 0,2/0,5 = 0,4.'
                        }
                    ];
                    saveFormulasData();
                }
            }

            function saveFormulasData() {
                localStorage.setItem('formulasData', JSON.stringify(formulasData));
            }

            function renderCategories() {
                // Les catégories sont déjà définies dans le HTML
            }

            function renderFormulas() {
                formulasContainer.innerHTML = '';

                let filteredFormulas = formulasData;

                // Filtrer par catégorie
                if (currentCategory !== 'all') {
                    filteredFormulas = filteredFormulas.filter(formula => formula.category === currentCategory);
                }

                // Filtrer par recherche
                const searchTerm = searchFormulasInput.value.toLowerCase();
                if (searchTerm) {
                    filteredFormulas = filteredFormulas.filter(formula => 
                        formula.title.toLowerCase().includes(searchTerm) || 
                        formula.description.toLowerCase().includes(searchTerm) ||
                        formula.equation.toLowerCase().includes(searchTerm)
                    );
                }

                if (filteredFormulas.length === 0) {
                    formulasContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #6c757d;">
                            <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <h3>Aucune formule trouvée</h3>
                            <p>Essayez de modifier vos critères de recherche ou d'ajouter de nouvelles formules.</p>
                        </div>
                    `;
                    return;
                }

                filteredFormulas.forEach(formula => {
                    const formulaElement = createFormulaCard(formula);
                    formulasContainer.appendChild(formulaElement);
                });

                // Re-rendre MathJax pour les nouvelles formules
                if (window.MathJax) {
                    MathJax.typeset();
                }
            }

            function createFormulaCard(formula) {
                const formulaElement = document.createElement('div');
                formulaElement.className = 'formula-card';
                
                const categoryName = getCategoryName(formula.category);
                const categoryIcon = getCategoryIcon(formula.category);

                formulaElement.innerHTML = `
                    <div class="formula-header">
                        <div>
                            <h3 class="formula-title">${formula.title}</h3>
                            <span class="formula-category"><i class="fas fa-${categoryIcon}"></i> ${categoryName}</span>
                        </div>
                    </div>
                    <div class="formula-content">
                        <div class="formula-equation">
                            \\(${formula.equation}\\)
                        </div>
                        <p class="formula-description">${formula.description}</p>
                        ${formula.example ? `
                            <div class="formula-example">
                                <div class="formula-example-title">Exemple :</div>
                                ${formula.example}
                            </div>
                        ` : ''}
                        <div class="formula-actions">
                            <button class="formula-btn secondary copy-formula-btn" data-formula="${formula.equation}">
                                <i class="fas fa-copy"></i> Copier
                            </button>
                            <button class="formula-btn save-formula-btn" data-id="${formula.id}">
                                <i class="fas fa-bookmark"></i> Sauvegarder
                            </button>
                        </div>
                    </div>
                `;

                // Ajouter les écouteurs d'événements pour les boutons
                const copyBtn = formulaElement.querySelector('.copy-formula-btn');
                copyBtn.addEventListener('click', function() {
                    copyFormulaToClipboard(this.getAttribute('data-formula'));
                });

                const saveBtn = formulaElement.querySelector('.save-formula-btn');
                saveBtn.addEventListener('click', function() {
                    const formulaId = parseInt(this.getAttribute('data-id'));
                    saveFormulaToFavorites(formulaId);
                });

                return formulaElement;
            }

            function copyFormulaToClipboard(formula) {
                // Créer un élément temporaire pour la copie
                const tempElement = document.createElement('textarea');
                tempElement.value = formula;
                document.body.appendChild(tempElement);
                tempElement.select();
                document.execCommand('copy');
                document.body.removeChild(tempElement);
                
                // Afficher un message de confirmation
                alert('Formule copiée dans le presse-papier !');
            }

            function saveFormulaToFavorites(formulaId) {
                // Récupérer les favoris existants
                let favorites = JSON.parse(localStorage.getItem('favoriteFormulas')) || [];
                
                // Vérifier si la formule est déjà dans les favoris
                if (!favorites.includes(formulaId)) {
                    favorites.push(formulaId);
                    localStorage.setItem('favoriteFormulas', JSON.stringify(favorites));
                    alert('Formule ajoutée aux favoris !');
                } else {
                    alert('Cette formule est déjà dans vos favoris.');
                }
            }

            function getCategoryName(category) {
                switch(category) {
                    case 'algebra': return 'Algèbre';
                    case 'geometry': return 'Géométrie';
                    case 'trigonometry': return 'Trigonométrie';
                    case 'calculus': return 'Analyse';
                    case 'probability': return 'Probabilités';
                    default: return 'Autre';
                }
            }

            function getCategoryIcon(category) {
                switch(category) {
                    case 'algebra': return 'calculator';
                    case 'geometry': return 'shapes';
                    case 'trigonometry': return 'wave-square';
                    case 'calculus': return 'chart-line';
                    case 'probability': return 'dice';
                    default: return 'square-root-variable';
                }
            }

            function performSearch() {
                renderFormulas();
            }

            // Fonctions d'administration
            function adminLogin() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    isAdminLoggedIn = true;
                    localStorage.setItem('adminLoggedIn', 'true');
                    showAdminPanel();
                    alert('Connexion réussie !');
                } else {
                    alert('Nom d\'utilisateur ou mot de passe incorrect.');
                }
            }
            
            function adminLogout() {
                isAdminLoggedIn = false;
                localStorage.removeItem('adminLoggedIn');
                adminLoginContainer.style.display = 'block';
                adminPanel.style.display = 'none';
                document.getElementById('admin-username').value = '';
                document.getElementById('admin-password').value = '';
                alert('Déconnexion réussie.');
            }
            
            function showAdminPanel() {
                adminLoginContainer.style.display = 'none';
                adminPanel.style.display = 'block';
                adminName.textContent = 'Administrateur';
                refreshAdminData();
            }
            
            function refreshAdminData() {
                loadFormulasTable();
            }
            
            function loadFormulasTable() {
                formulasTableBody.innerHTML = '';
                
                formulasData.forEach(formula => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formula.id}</td>
                        <td>${getCategoryName(formula.category)}</td>
                        <td>${formula.title}</td>
                        <td>\\(${formula.equation}\\)</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-id="${formula.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" data-id="${formula.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    formulasTableBody.appendChild(row);
                });
                
                // Re-rendre MathJax pour les formules dans le tableau
                if (window.MathJax) {
                    MathJax.typeset();
                }
                
                // Ajouter les écouteurs d'événements pour les boutons d'action
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editFormula(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteFormula(id);
                    });
                });
            }
            
            function showFormulaForm() {
                isEditingFormula = false;
                editingFormulaId = null;
                document.getElementById('form-title').textContent = 'Ajouter une Formule';
                formulaForm.style.display = 'block';
                resetFormulaForm();
            }
            
            function hideFormulaForm() {
                formulaForm.style.display = 'none';
            }
            
            function resetFormulaForm() {
                document.getElementById('formula-category').value = 'algebra';
                document.getElementById('formula-title').value = '';
                document.getElementById('formula-equation').value = '';
                document.getElementById('formula-description').value = '';
                document.getElementById('formula-example').value = '';
                formulaPreview.textContent = 'Aperçu de la formule';
            }
            
            function updateFormulaPreview() {
                const equation = document.getElementById('formula-equation').value;
                if (equation) {
                    formulaPreview.innerHTML = `\\(${equation}\\)`;
                    // Re-rendre MathJax pour l'aperçu
                    if (window.MathJax) {
                        MathJax.typeset([formulaPreview]);
                    }
                } else {
                    formulaPreview.textContent = 'Aperçu de la formule';
                }
            }
            
            function editFormula(id) {
                isEditingFormula = true;
                editingFormulaId = id;
                document.getElementById('form-title').textContent = 'Modifier la Formule';
                formulaForm.style.display = 'block';
                
                const formula = formulasData.find(f => f.id === id);
                if (formula) {
                    document.getElementById('formula-category').value = formula.category;
                    document.getElementById('formula-title').value = formula.title;
                    document.getElementById('formula-equation').value = formula.equation;
                    document.getElementById('formula-description').value = formula.description;
                    document.getElementById('formula-example').value = formula.example || '';
                    
                    // Mettre à jour l'aperçu
                    updateFormulaPreview();
                }
            }
            
            function deleteFormula(id) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cette formule ?')) {
                    formulasData = formulasData.filter(f => f.id !== id);
                    saveFormulasData();
                    refreshAdminData();
                    renderFormulas();
                }
            }
            
            function saveFormula() {
                const category = document.getElementById('formula-category').value;
                const title = document.getElementById('formula-title').value;
                const equation = document.getElementById('formula-equation').value;
                const description = document.getElementById('formula-description').value;
                const example = document.getElementById('formula-example').value;
                
                if (!title || !equation || !description) {
                    alert('Veuillez remplir tous les champs obligatoires.');
                    return;
                }
                
                if (isEditingFormula) {
                    // Mettre à jour la formule existante
                    const formulaIndex = formulasData.findIndex(f => f.id === editingFormulaId);
                    if (formulaIndex !== -1) {
                        formulasData[formulaIndex].category = category;
                        formulasData[formulaIndex].title = title;
                        formulasData[formulaIndex].equation = equation;
                        formulasData[formulaIndex].description = description;
                        formulasData[formulaIndex].example = example;
                    }
                } else {
                    // Ajouter une nouvelle formule
                    const newId = getNextFormulaId();
                    formulasData.push({
                        id: newId,
                        category: category,
                        title: title,
                        equation: equation,
                        description: description,
                        example: example
                    });
                }
                
                saveFormulasData();
                hideFormulaForm();
                refreshAdminData();
                renderFormulas();
                alert('Formule enregistrée avec succès !');
            }
            
            function getNextFormulaId() {
                let maxId = 0;
                formulasData.forEach(formula => {
                    if (formula.id > maxId) {
                        maxId = formula.id;
                    }
                });
                return maxId + 1;
            }
        });
    </script>
</body>
</html>